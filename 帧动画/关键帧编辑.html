<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>threejs</title>
  <style type="text/css">
    body{
      margin: 0;
      overflow: hidden;
    }
  </style>
  <script src="http://www.yanhuangxueyuan.com/threejs/build/three.js"></script>
  <script src="http://www.yanhuangxueyuan.com/threejs/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
  <input type="range" id="rang" min="0" max="20" value="0" step="1">
  <script>
    //初始化环境
    var scene = new THREE.Scene()
    //创建模型
    var box = new THREE.BoxGeometry(60,20,20)//立方体
    var sphere = new THREE.SphereGeometry(20, 20, 20);//球体
    
    //将材质赋予模型并添加到环境中
    var mesh1 = new THREE.Mesh(box,new THREE.MeshLambertMaterial({
      color : 0x0000ff
    }))
    mesh1.name = "Box"
    var mesh2 = new THREE.Mesh(sphere,new THREE.MeshLambertMaterial({
      color : 0x0000ff
    }))
    mesh2.name = "Sphere"
    var group = new THREE.Group()
    group.add(mesh1)
    group.add(mesh2)
    scene.add(group)
    
    // 编辑group子元素的帧动画.
    var values = [0,0,0,200,0,0]//与时间点对应的值组成的数组
    // 创建位置关键帧对象：0时刻对应0，0，0； 10时刻对应150，0，0
    var posTrack = new THREE.KeyframeTrack('Box.position',[0,15],values)
    // 创建颜色关键帧
    var colorKF = new THREE.KeyframeTrack('Box.material.color', [5, 15], [0, 1, 0,0 , 0.5, 1]);
    // 创建名为Sphere对象的关键帧数据  从0~20时间段，尺寸scale缩放3倍
    var scaleTrack = new THREE.KeyframeTrack('Sphere.scale', [0, 20], [1, 1, 1, 3, 3, 3]);
    
    // duration决定了默认的播放时间，一般取所有帧动画的最大时间
    // duration偏小，帧动画数据无法播放完，偏大，播放完帧动画会继续空播放
    var duration = 20;
    // 多个帧动画作为元素创建一个剪辑clip对象，命名"default"，持续时间20
    var clip = new THREE.AnimationClip("default", duration, [posTrack, colorKF, scaleTrack]);

    // 播放编辑好的关键帧数据
    var mixer = new THREE.AnimationMixer(group)
    // 剪辑clip错位参数
    var AnimationAction = mixer.clipAction(clip)
    // 通过操作Action设置播放方式
    AnimationAction.timeScale = 20
    //不循环播放(默认是循环播放)
    AnimationAction.loop = THREE.LoopOnce;
    //暂停在最后一帧播放的状态
    AnimationAction.clampWhenFinished=true;
    AnimationAction.time = 0
    clip.duration = AnimationAction.time
    AnimationAction.play();
    
    //环境光
    var ambient = new THREE.AmbientLight(0x444444);
    scene.add(ambient);
    //点光源
    var point1 = new THREE.PointLight(0x000fff,1)
    point1.position.set(150,150,150)
    scene.add(point1)
    var point2 = new THREE.PointLight(0x000fff,1)
    point2.position.set(-150,150,-150)
    scene.add(point2)
    
    //设置相机
    var width = window.innerWidth; 
    var height = window.innerHeight; 
    var k = width / height; //窗口宽高比
    var s = 150; //三维场景显示范围控制系数，系数越大，显示的范围越大
    var camera = new THREE.OrthographicCamera(-s*k, s*k,s,-s,1,1000)
    
    //设置相机位置
    camera.position.set(400, 200,400);
    camera.lookAt(50,0,0)
    
    //渲染对象
    var renderer = new THREE.WebGLRenderer();
    renderer.setSize(width, height);//设置渲染区域尺寸
    renderer.setClearColor(0xb9d3ff, 1); //设置背景颜色
    document.body.appendChild(renderer.domElement); //body元素中插入canvas对象
    //辅助坐标系
    var AxesHelper= new THREE.AxesHelper(1000);
    scene.add(AxesHelper);
    
    // 创建一个时钟对象Clock
    var clock = new THREE.Clock();
    function render(){
      renderer.render(scene, camera)
      // 更新混合器相关的时间
      mixer.update(clock.getDelta());
      requestAnimationFrame(render)
    }
    render()
    
    document.getElementById('rang').oninput = (e) => {
      const val = e.target.value
      AnimationAction.time = Number(val)
    }
  </script>
</body>
</html>
