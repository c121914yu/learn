<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>threejs</title>
  <style type="text/css">
    body{
      margin: 0;
      overflow: hidden;
    }
  </style>
  <!-- <script type="text/javascript" src="http://www.yanhuangxueyuan.com/threejs/build/three.js"></script> -->
  <!-- <script src="http://www.yanhuangxueyuan.com/threejs/examples/js/controls/OrbitControls.js"></script> -->
  <script src="../lib/three.js" type="text/javascript" charset="utf-8"></script>
  <script src="../lib/OrbitControls.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
  <script src="../move.js" type="text/javascript" charset="utf-8"></script>
  <script>
    //初始化环境
    var scene = new THREE.Scene()
    
    // 加载树木
    var textureTree = new THREE.TextureLoader().load('tree.png')
    for(let i=0;i<500;i++){
      // 创建树模型
      let tree = new THREE.Sprite(new THREE.SpriteMaterial({
        map : textureTree
      }))
      // 控制树大小
      tree.scale.set(20, 20, 1)
      let k1 = Math.random() - 0.5;
      let k2 = Math.random() - 0.5;
      // 设置模型位置，在xoz平面上随机分布
      tree.position.set(900*k1,10, 900*k2)
      scene.add(tree)
    }
    // 加载雨滴
    var textureRain = new THREE.TextureLoader().load('rain.png')
    var rainGroup = new THREE.Group()
    for(let i=0;i<2000;i++){
      let rain = new THREE.Sprite(new THREE.SpriteMaterial({
        map : textureRain
      }))
      rain.scale.set(2, 2, 1)
      let k1 = Math.random() - 0.5;
      let k2 = Math.random() - 0.5;
      let k3 = Math.random()
      rain.position.set(900*k1,(1+k3)*50,900*k2)
      rainGroup.add(rain)
    }
    scene.add(rainGroup)
      
    // 创建草地
    var plane = new THREE.PlaneGeometry(1000,1000)
    var textureGrass = new THREE.TextureLoader().load('grass.jpg')
    //设置纹理重复
    textureGrass.wrapS = THREE.RepeatWrapping
    textureGrass.wrapT = THREE.RepeatWrapping
    textureGrass.repeat.set(10,10)
    var material = new THREE.MeshLambertMaterial({
      map : textureGrass,
      side: THREE.DoubleSide,
    })
    var mesh = new THREE.Mesh(plane,material)
    scene.add(mesh)
    mesh.rotateX(-Math.PI / 2)
      
    //环境光
    var ambient = new THREE.AmbientLight(0x999999);
    scene.add(ambient);
    var light = new THREE.DirectionalLight(0xffffff,1)
    light.position.set(150,150,150)
    scene.add(light)
    
    //设置相机
    var width = window.innerWidth; 
    var height = window.innerHeight; 
    var k = width / height; //窗口宽高比
    
    var camera = new THREE.PerspectiveCamera(80, width / height,0.1,1000);
    //设置相机位置
    camera.position.set(0,5,0)
    var lx = ly = lz = 5
    camera.lookAt(lx,ly,lz); //设置相机方向(指向的场景对象)
    
    //渲染对象
    var renderer = new THREE.WebGLRenderer();
    renderer.setSize(width, height);//设置渲染区域尺寸
    renderer.setClearColor(0xb9d3ff, 1); //设置背景颜色
    document.body.appendChild(renderer.domElement); //body元素中插入canvas对象
    
    function render(){
      renderer.render(scene,camera);
      rainGroup.children.forEach(rain => {
        rain.position.y -= 1
        if(rain.position.y < 0){
          let k1 = Math.random() - 0.5;
          let k2 = Math.random() - 0.5;
          let k3 = Math.random()
          rain.position.set(900*k1,(1+k3)*50,900*k2)
        }
      })
      requestAnimationFrame(render)
    }
    render()
    var controls = new THREE.OrbitControls(camera,renderer.domElement);//创建控件对象
    // move(renderer.domElement)
  </script>
</body>
</html>
